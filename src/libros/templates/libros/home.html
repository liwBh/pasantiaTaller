{% extends '../_base_gentelella.html' %}
{% load gtsettings %}
{% load i18n %}
{% load static %}

{% block title %} Taller SOLVO 2024 {% endblock %}

{% block extra_css %}
  {% block css %}{% endblock %}
{% endblock %}

{% block extra_head %}
    <meta name="description" content="Taller para pasantes 2024">
    <meta name="author" content="info@solvosoft.com">
    <meta name="keywords" content="Taller pasantes 2024">

    <link rel="icon" href="{% static 'img/favicon.ico' %}">
    <meta name="theme-color" content="#ffffff">
  {% block link %}{% endblock link %}
  {% block script %}{% endblock script %}
{% endblock %}

{% block content %}
    <h1 class="text-center"> {% trans 'Lista de Libros' %} </h1>
    <div class="row">
        <table class="table table-hover table-striped w-100 table-responsive" id="tb_libros">
        </table>
    </div>

    <a class="btn btn-primary" href="{% url 'libros:libro' %}" role="button">Kendrik CRUD</a>


    {% url "libros:api-libro-list" as list_obj_url %}
    {% trans 'Crear Libro' as create_obj_tittle %}
    {% include 'gentelella/blocks/modal_template.html' with form=create_form form_id="create_obj_form" id="create_obj_modal" title=create_obj_tittle modal_class=create_obj_tittle url=list_obj_url %}

    {% url "libros:api-libro-detail" 0 as detail_obj_url %}
    {% trans 'Actualizar Libro' as update_obj_tittle %}
    {% include 'gentelella/blocks/modal_template.html' with form=update_form form_id="update_obj_form" id="update_obj_modal" title=update_obj_tittle url=detail_obj_url %}

    {% trans 'Eliminar Libro' as delete_obj_tittle %}
    {% include 'gentelella/blocks/modal_template_delete.html' with form=delete_form form_id="delete_obj_form" id="delete_obj_modal" title=delete_obj_tittle url=detail_obj_url %}

{% endblock %}


{% block js %}
    {{ block.super }}
    <script>

        window.name = "librolistview";

        var object_urls = {
            list_url: "{% url 'libros:api-libro-list' %}",
            create_url: "{% url 'libros:api-libro-list' %}",
            destroy_url: "{% url "libros:api-libro-detail" 0 %}",
            update_url: "{% url "libros:api-libro-detail" 0 %}"
        }

        let CATEGORIAS = [
            [0, "sin definir"],
            [1, "Romance"],
            [2, "Acción"],
            [3, "Terror"],
        ]

        datatable_inits = {
            columns: [
                {data: "id", name: "id", title: "ID", type: "string", visible: false},
                {data: "nombre", name: "nombre", title: "Nombre", type: "string", visible: true},
                {data: "autor__nombre", name: "autor__nombre", title: "Nombre Autor", type: "string", visible: true},
                {
                    data: "autor__apellidos",
                    name: "autor__apellidos",
                    title: "Apellidos Autor",
                    type: "string",
                    visible: true
                },
                {data: "categoria_display", name: "categoria", title: "Categoría", type: "select",choices:CATEGORIAS, visible: true},
                {
                    data: "fecha_publicacion",
                    name: "fecha_publicacion",
                    title: "Fecha publicación",
                    type: "date",
                    "dateformat": document.date_format,
                    visible: true
                },
                {data: "actions", name: "actions", title: "Acciones", type: "string", visible: true},
            ],
            addfilter: true,
        }

        var libro_modalids = {
            create: "#create_obj_modal",
            destroy: "#delete_obj_modal",
            update: "#update_obj_modal"
        }

        var libro_actions = {
            table_actions: [],  //table_actions
            object_actions: [],
            title: 'Actions',
            className: "no-export-col"
        }

        icons = {
            create: '<i class="fa fa-plus" aria-hidden="true"></i>',
            clear: '<i class="fa fa-eraser" aria-hidden="true"></i>',
            detail: 'fa fa-eye',
            update: 'fa fa-edit me-1 fa-lg',
            destroy: 'fa fa-trash fa-lg'
        }

        let objconfig = {
            datatable_element: "#tb_libros",
            modal_ids: libro_modalids,
            actions: libro_actions,
            datatable_inits: datatable_inits,
            add_filter: true,
            relation_render: {'field_autocomplete': 'text'},
            delete_display: data => data['nombre'],
            create: "btn-success",
            icons: icons,
            urls: object_urls
        }

        let ocrud = ObjectCRUD("librocrudobj", objconfig)
        ocrud.init();
    </script>
{% endblock %}